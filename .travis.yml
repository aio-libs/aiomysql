language: python

python:
    - 3.6
    - 3.7
    - 3.8
    - 3.9

env:
  global:
    - DB=mariadb
    - DBTAG=10.6
  matrix:
  # - PYTHONASYNCIODEBUG=1
    - PYTHONASYNCIODEBUG=

services:
    - docker

matrix:
  include:
    - python: 3.9
      env:
        - PYTHONASYNCIODEBUG=
        - DB=mariadb
        - DBTAG=10.7
    - python: 3.9
      env:
        - PYTHONASYNCIODEBUG=
        - DB=mysql
        - DBTAG=5.7

# before_script:
#   - "mysql -e 'SELECT VERSION()'"
#   - "mysql -e 'DROP DATABASE IF EXISTS test_pymysql; create database test_pymysql  DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;'"
#   - "mysql -e 'DROP DATABASE IF EXISTS test_pymysql2; create database test_pymysql2 DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;'"

install:
  - pip install -Ur requirements-dev.txt
  - pip install .
  - pip install codecov

deploy:
  provider: pypi
  distributions: "sdist bdist_wheel"
  on:
    tags: true
    repo: alviezhang/aiomysql-fork
    python: 3.9

script:
  - make cov

after_success:
  - codecov
